app-id: org.tigervnc.TigerVNC
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: vncviewer
rename-icon: tigervnc
rename-desktop-file: vncviewer.desktop
modules:
  - name: fltk
    buildsystem: cmake
    sources:
      - type: archive
        url: https://www.fltk.org/pub/fltk/1.3.8/fltk-1.3.8-source.tar.gz
        sha256: f3c1102b07eb0e7a50538f9fc9037c18387165bc70d4b626e94ab725b9d4d1bf
  - name: pam
    buildsystem: simple
    sources:
      - type: archive
        url: https://github.com/linux-pam/linux-pam/releases/download/v1.5.2/Linux-PAM-1.5.2.tar.xz
        sha256: e4ec7131a91da44512574268f493c6d8ca105c87091691b8e9b56ca685d4f94d
    build-commands:
      - ./configure --prefix=$FLATPAK_DEST
      - make
      - make install
      - cp -r libpam/include/* $FLATPAK_DEST/include
  - name: vncviewer
    buildsystem: cmake
    sources:
      - type: git
        url: https://github.com/TigerVNC/tigervnc.git
        tag: v1.12.0
        commit: f1f65c5904e6143cd242c0f1c53d7f8147dabd74
    config-opts:
      - "-DCMAKE_CXX_FLAGS=-lpng16"
  - name: appdata
    buildsystem: simple
    sources:
      - type: file
        url: https://raw.githubusercontent.com/TigerVNC/tigervnc/704eff041c3e5dd0fb712fa76774b8d3f6dd31f9/vncviewer/org.tigervnc.vncviewer.metainfo.xml.in
        dest-filename: org.tigervnc.TigerVNC.metainfo.xml
        sha256: 743a7565b95490ede10eae15259fab432fd1c385adece44c455553f7faf21bb2
      - type: patch
        path: metainfo.patch
        strip-components: 0
    build-commands:
      - install -Dm644 org.tigervnc.TigerVNC.metainfo.xml $FLATPAK_DEST/share/metainfo/org.tigervnc.TigerVNC.metainfo.xml
finish-args:
  - --persist=.vnc  # For default config and history.
  - --persist=vnc   # For saved connection files.
  - --share=ipc
  - --share=network
  - --socket=x11
cleanup:
  - '/bin/fltk-config'
  - '/bin/fluid'
  - '/bin/vncconfig'
  - '/bin/vncpasswd'
  - '/bin/x0vncserver'
  - '/etc'
  - '/include'
  - '/lib/debug'
  - '/lib/libpam*'
  - '/lib/pkgconfig'
  - '/lib/security'
  - '/lib/systemd'
  - '/libexec'
  - '/sbin'
  - '/share/doc'
  - '/share/fltk'
  - '/share/man'
  - '/share/mime'
  - '/share/runtime'
  - 'Linux-PAM.mo'
  - 'fluid.desktop'
  - 'fluid.png'
